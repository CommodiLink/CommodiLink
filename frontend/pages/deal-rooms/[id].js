import {useEffect,useState} from 'react';import axios from 'axios';export default function DealRoom(){const [messages,setMessages]=useState([]);const [docs,setDocs]=useState([]);const [body,setBody]=useState('');const id=typeof window!=='undefined'?window.location.pathname.split('/').pop():null;const t=typeof window!=='undefined'?localStorage.getItem('token'):'';const headers={Authorization:`Bearer ${t}`};useEffect(()=>{if(!id)return;axios.get(`${process.env.NEXT_PUBLIC_API_BASE_URL}/api/dealrooms/${id}/messages`,{headers}).then(r=>setMessages(r.data));axios.get(`${process.env.NEXT_PUBLIC_API_BASE_URL}/api/dealrooms/${id}/docs`,{headers}).then(r=>setDocs(r.data));},[id]);const send=async(e)=>{e.preventDefault();const r=await axios.post(`${process.env.NEXT_PUBLIC_API_BASE_URL}/api/dealrooms/${id}/messages`,{body},{headers});setMessages([...messages,r.data]);setBody('');};const upload=async(e)=>{const file=e.target.files?.[0];if(!file)return;const form=new FormData();form.append('file',file);const r=await axios.post(`${process.env.NEXT_PUBLIC_API_BASE_URL}/api/dealrooms/${id}/docs`,form,{headers});setDocs([...docs,r.data]);};return(<div className='container py-12'><h1 className='text-3xl font-bold mb-6'>Deal Room #{id}</h1><div className='grid md:grid-cols-2 gap-6'><div className='card'><div className='card-body'><h3 className='font-semibold mb-2'>Messages</h3><div className='space-y-2 max-h-80 overflow-auto'>{messages.map(m=>(<div key={m.id} className='text-sm'><b>User {m.authorUserId}:</b> {m.body}</div>))}</div><form onSubmit={send} className='mt-3 flex gap-2'><input className='border p-2 flex-1 rounded-lg' value={body} onChange={e=>setBody(e.target.value)} placeholder='Type message...'/><button className='btn btn-primary'>Send</button></form></div></div><div className='card'><div className='card-body'><h3 className='font-semibold mb-2'>Documents</h3><input type='file' onChange={upload} className='mb-3'/><ul className='text-sm space-y-1'>{docs.map(d=>(<li key={d.id}'>ðŸ“„ {d.filename}</li>))}</ul></div></div></div></div>)}
